@page "/discos"
@using escuchify_app.Components.Models
@inject HttpClient HttpClient
@inject NavigationManager NavigationManager
@rendermode InteractiveServer

<PageTitle>Discos</PageTitle>

<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2 class="fw-bold m-0" style="color: var(--text-main);">Discos</h2>
        <small class="text-muted">Catálogo de álbumes y EPs</small>
    </div>
    <a class="btn btn-primary rounded-pill px-4" href="/discos/nuevo">
        <i class="bi bi-plus-lg me-2"></i>Nuevo Disco
    </a>
</div>

@if (discos == null)
{
    <div class="text-center mt-5">
        <div class="spinner-border text-primary" role="status"></div>
        <p class="mt-2 text-muted">Cargando discos...</p>
    </div>
}
else if (discos.Length == 0)
{
    <div class="alert alert-secondary border-0" style="background-color: var(--bg-card);">
        <i class="bi bi-disc me-2"></i> No hay discos registrados.
    </div>
}
else
{
    <div class="table-responsive">
        <table class="table table-hover align-middle" style="border-collapse: separate; border-spacing: 0;">
            <thead>
                <tr class="text-uppercase text-muted small border-bottom-0">
                    <th scope="col">Título</th>
                    <th scope="col">Año</th>
                    <th scope="col">Tipo</th>
                    <th scope="col">Artista</th>
                    <th scope="col" class="text-end pe-3">Acciones</th>
                </tr>
            </thead>
            <tbody>
                @foreach (Disco disco in discos)
                {
                    <tr class="disco-row">
                        <td>
                            <span class="fw-bold text-white">@disco.Titulo</span>
                        </td>
                        <td class="text-muted">@disco.AnioLanzamiento</td>
                        <td class="text-muted">
                            <span class="badge" style="background-color: var(--bg-panel); border: 1px solid var(--border-color); color: var(--text-muted);">
                                @disco.TipoDisco
                            </span>
                        </td>
                        <td class="text-info">
                            @(disco.Artista?.Nombre ?? "Desconocido")
                        </td>
                        
                        <td class="text-end pe-3">
                            <div class="btn-group">
                                <button class="btn btn-icon" title="Ver Detalle" @onclick="() => VerDisco(disco.Id)">
                                    <i class="bi bi-eye"></i>
                                </button>
                                <button class="btn btn-icon" title="Editar" @onclick="() => EditarDisco(disco.Id)">
                                    <i class="bi bi-pencil"></i>
                                </button>
                                <button class="btn btn-icon text-danger" title="Eliminar" @onclick="() => EliminarDisco(disco.Id)">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
}

<style>
    .disco-row {
        transition: background-color 0.2s;
        border-radius: 4px;
    }
    .disco-row:hover {
        background-color: rgba(255, 255, 255, 0.05) !important;
    }
    
    .btn-icon {
        background: transparent;
        border: none;
        color: var(--text-muted);
        transition: all 0.2s;
        padding: 0.25rem 0.5rem;
        font-size: 1.1rem;
    }
    .btn-icon:hover {
        color: var(--text-main);
        transform: scale(1.1);
        background-color: rgba(255,255,255,0.1);
        border-radius: 50%;
    }
    .btn-icon.text-danger:hover {
        color: #ef4444 !important;
        background-color: rgba(239, 68, 68, 0.1);
    }
</style>

@code {
    private Disco[]? discos;

    protected override async Task OnInitializedAsync()
    {
        await LoadDiscos();
    }

    private async Task LoadDiscos()
    {
        try 
        {
            discos = await HttpClient.GetFromJsonAsync<Disco[]>("http://localhost:5126/discos");
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error cargando discos: {ex.Message}");
        }
    }

    private void VerDisco(int id) => NavigationManager.NavigateTo(uri: $"/discos/{id}");
    private void EditarDisco(int id) => NavigationManager.NavigateTo(uri: $"/discos/editar/{id}");
    private void EliminarDisco(int id) => NavigationManager.NavigateTo(uri: $"/discos/eliminar/{id}");
}
@page "/canciones/{Id:int}"
@using escuchify_app.Components.Models
@inject HttpClient HttpClient
@inject NavigationManager NavigationManager
@rendermode InteractiveServer

<PageTitle>Detalle de Canción</PageTitle>
<h1>Detalle de Canción</h1>

@if (cancion == null)
{
    <p><em>Cargando...</em></p>
}
else
{
    <dl class="row">
        <dt class="col-sm-2">Id</dt>
        <dd class="col-sm-10">@cancion.Id</dd>

        <dt class="col-sm-2">Título</dt>
        <dd class="col-sm-10">@cancion.Titulo</dd>

        <dt class="col-sm-2">Duración</dt>
        <dd class="col-sm-10">@cancion.Duracion</dd>

        <dt class="col-sm-2">Género</dt>
        <dd class="col-sm-10">@cancion.Genero</dd>

        <dt class="col-sm-2">Disco</dt>
        <dd class="col-sm-10">@(cancion.Disco?.Titulo ?? "Desconocido")</dd>
        
        <dt class="col-sm-2">Artista</dt>
        <dd class="col-sm-10">@(cancion.Disco?.Artista?.Nombre ?? "Desconocido")</dd>
    </dl>

    <div class="mb-3">
        <button class="btn btn-warning" @onclick="EditarCancion">Editar</button>
        <button class="btn btn-secondary" @onclick="Volver">Volver</button>
    </div>
}

@code {
    [Parameter] public int Id { get; set; }
    private Cancion? cancion;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            cancion = await HttpClient.GetFromJsonAsync<Cancion>($"http://localhost:5126/canciones/{Id}");
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error: {ex.Message}");
        }
    }

    // Métodos para evitar el error de comillas en el HTML
    private void EditarCancion()
    {
        NavigationManager.NavigateTo($"/canciones/editar/{Id}");
    }

    private void Volver()
    {
        NavigationManager.NavigateTo("/canciones");
    }
}